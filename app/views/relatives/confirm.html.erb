<div class="relative-confirm-body">
  <% @request_residents.each do |user, r_ids| %>
    <% current_facility.acceptance_requests(user, current_facility).each do |request| %>
      <div class="card">
        <div class="relative-new-container">
          <div class="relative-confirm-section">
          <nav class="level" id="level-bottom">
            <p class="has-text-weight-bold is-size-5">
              <% @acceptance_user = User.find(request.user_id) %>
              <h1 class="has-text-weight-bold is-size-4"><%= @acceptance_user.name %><span class="is-size-5 req-name"> 様からの申請</span></h1>
            </p>
          </nav>
            <table class="table is-narrow user-edit-table is-bordered" id="relative-confirm-table">
              <tbody>
                <tr>
                  <th>利用者名</th>
                  <td>
                    <%= simple_format(request.req_name) %>
                  </td>
                </tr>
                <tr>
                  <th>連絡先</th>
                  <td>
                    <%= simple_format(request.req_phone) %>
                  </td>
                </tr>
                <tr>
                  <th>住所</th>
                  <td>
                    <%= simple_format(request.req_address) %>
                  </td>
                </tr>
                <tr>
                  <th>紐付け</th>
                  <td>
                    <p class="is-size-7">（登録済み入居者）</p>
                    <% @acceptance_user.residents.each do |resident| %>
                      <span class="registered-name"><%= resident.name %></span>
                    <% end %><br><br>

                    <p>↓↓</p>

                    <p class="is-size-7">（承認後の入居者）</p>
                    <% request_numbers = r_ids[:resident_ids].map(&:to_i).reject{|e| e == 0} %>
                    <% if request_numbers.count == @acceptance_user.residents.count %>
                      <p style="color: red; font-weight: bold;">申請を保留します</p>
                    <% else %>
                      <% request_numbers.each do |n| %>
                        <% newly_resident = Resident.find(n) %>
                        <span class="approval-name"><%= newly_resident.name %></span>
                      <% end %>
                    <% end %>

                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    <% end %>
  <% end %>
  <%= link_to 'まとめて承認', update_relatives_relatives_path(update_relatives: @request_residents), method: :patch, class: "button is-primary is-light has-text-weight-bold", id: "req-submit" %>
</div>
