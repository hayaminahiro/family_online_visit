<h1>予約状況一覧画面</h1>

<div class="card" id="mypage-reservations-calendar">
  <div class="has-text-centered">
    <div class="is-centered">

      <%= month_calendar(attribute: :calendar_day, events: @reservations) do |date, reservations| %>
        <%= l(date, format: :short) %>


        <button class="button is-link is-light" id=<%= date %>>予約可</button><br>




        <% @reservations.each do |reservation| %>
          <% if reservation.facility_id == @facility.id && current_user.name == reservation.reservation_user %>

            <%= link_to "予約情報(#{l(reservation.started_at, format: :time)}~)", facility_reservation_path(@facility, reservation), class:"tag is-danger is-light" if reservation.reservation_date == date %>

          <% end %>
        <% end %>

        <!-- 予約時間 モーダル表示 -->
        <div class="modal" id=<%= l(date, format: :short) %>>
          <div class="modal-background"></div>
          <div class="modal-card">
            <header class="modal-card-head" style="background-color: #e3dcca;">
              <p class="modal-card-title is-half has-text-weight-bold reserve-modal is-size-3" style="color: #401c00;">予約画面</p>
              <button class="delete" aria-label="close" id="close"></button>
            </header>
            <section class="modal-card-body">
              <div class="field">
                <p class="title-in-modal"><%= l(date.to_time, format: :date) %></p>

                <p class="modal-description">予約時間を選択して下さい。</p>
              </div>
              <div class="field">


                  <% if @reservations.where(reservation_date: date).where(started_at: Reservation::TIME_1000).count < 1 %>
                    <%= link_to new_facility_reservation_path(date: date, time: Reservation::TIME_1000), class:"button is-info" do %>
                      <i class="far fa-clock"></i>&nbsp;10:00
                    <% end %>
                  <% end %>

                  <% if @reservations.where(reservation_date: date).where(started_at: "2000-01-01 11:00:00 +0900").count < 1 %>
                    <%= link_to new_facility_reservation_path(date: date, time: "2000-01-01 11:00:00 +0900"), class:"button is-info" do %>
                      <i class="far fa-clock"></i>&nbsp;11:00
                    <% end %>
                  <% end %>
                  <% if @reservations.where(reservation_date: date).where(started_at: "2000-01-01 14:00:00 +0900").count < 1 %>
                    <%= link_to new_facility_reservation_path(date: date, time: "2000-01-01 14:00:00 +0900"), class:"button is-info" do %>
                      <i class="far fa-clock"></i>&nbsp;14:00
                    <% end %>
                  <% end %>
                  <% if @reservations.where(reservation_date: date).where(started_at: "2000-01-01 15:00:00 +0900").count < 1 %>
                    <%= link_to new_facility_reservation_path(date: date, time: "2000-01-01 15:00:00 +0900"), class:"button is-info" do %>
                      <i class="far fa-clock"></i>&nbsp;15:00
                    <% end %>
                  <% end %>


              </div>
            </section>
            <footer class="modal-card-foot">
              <p>ーーー</p>
            </footer>

            <script>
              $(document).ready(function () {
                $("#<%= date %>").on("click", function () {
                  $("div#<%= l(date, format: :short) %>").addClass("is-active");
                })

                $("#close, div.modal-background").on("click", function () {
                  $("div#<%= l(date, format: :short) %>").removeClass("is-active");
                })
              });
            </script>

          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
