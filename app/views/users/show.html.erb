<div class="mypage-main-content">
  <mypage-aside>
    <div>
      <div class="profile-section">
        <%= current_user.user_icon_image %>
        <p class="has-text-centered"><%= current_user.name %></p>
      </div>
    </div>
    <div class="mypage-side-link">
      <a class="panel-tab is-active mypage-links has-text-centered" onclick="openTab(event,'Web')"><i class="fas fa-home"></i><p>予約</p></a>
      <a class="panel-tab mypage-links has-text-centered" onclick="openTab(event,'Faci')"><i class="fas fa-images"></i><p>写真</p></a>
      <a class="panel-tab mypage-links has-text-centered" onclick="openTab(event,'Resi')"><i class="fas fa-film"></i><p>動画</p></a>
      <a class="panel-tab mypage-links has-text-centered has-text-centered" onclick="openTab(event,'Infor')"><i class="fas fa-phone-volume"></i><p>お問い合わせ</p></a>
    </div>
  </mypage-aside>

  <mypage-main>
    <article>
      <section class="hero-image-user">
        <div class="user-home-image">
        <% month = Date.today.month %>
        <% if month.in?([ 12, 1, 2 ]) %>
          <%= image_tag 'https://img-photo.s3-ap-northeast-1.amazonaws.com/uploads/content_image/winter.jpg', class: "mypage-image"%>
        <% elsif month.in?([ 3, 4, 5 ]) %>
          <%= image_tag 'https://img-photo.s3-ap-northeast-1.amazonaws.com/uploads/content_image/spring.jpg', class: "mypage-image" %>
        <% elsif month.in?([ 6, 7, 8 ]) %>
          <%= image_tag 'https://img-photo.s3-ap-northeast-1.amazonaws.com/uploads/content_image/summer.jpg', class: "mypage-image"%>
        <% elsif month.in?([ 9, 10, 11 ]) %>
          <%= image_tag 'https://img-photo.s3-ap-northeast-1.amazonaws.com/uploads/content_image/+autumn.jpg', class: "mypage-image"%>
        <% end %>
          <div class="user-icon-outline">
            <%= current_user.user_icon_responsive %>
          </div>
        </div>
      </section>

      <div id="Web" class="content-tab">
        <div class="Web-section">
          <div class="columns">
            <% current_user.grouped_facility.each do |facility_id, other| %>
              <div class="card-content" id="my-page-info-content">
                <div class="card" style="display: flex; border-radius: 11px;">
                  <div class="media-left">
                    <small><%= current_user.mypage_facilities_icon(facility_id) %></small>
                  </div>
                  <div class="media-content" id="web-media-section">
                    <% current_user.mypage_informations(facility_id).last(2).each do |information| %>
                    <div class="mypage-information">
                      <div>
                        <div class="box" id="mypage-user-box">
                          <div class="media">
                            <%= current_user.mypage_informations_icon(information) %>
                            <div class="media-content">
                              <div class="content" id="edit-content">
                                <p class="is-size-7">
                                <strong><%= information.title.truncate(9) %></strong><br>
                                  <small><%= information.facility.facility_name %></small>
                                  <br>
                                  <span><%= information.news.truncate(10) %></span>
                                </p>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <% end %>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        </div>
        <div class="web-container">
          <div class="card" id="mypage-reservations-calendar">
            <div class="has-text-centered">
              <div class="is-centered">
                <%= month_calendar(attribute: :calendar_day, events: current_user.reservation_calendar) do |date, reservations| %>
                  <%= l(date, format: :short) %>
                <% end %>
              </div><br>
            </div>
          </div>
          <div class="card" id="mypage-reservations-list">
            <div class="card-content">
              <div class="media">
                <div class="media-content">
                  <p class="title is-4">予約の確認</p>
                  <p class="subtitle is-6">予約した情報が表示されます</p>
                </div>
              </div>
              <div class="content">
                <table class="table is-fullwidth is-narrow user-edit-table" id="mypage-reserve-table">
                  <tbody>
                    <tr>
                      <th>
                        <figure class="image is-48x48">
                          <img src="https://bulma.io/images/placeholders/96x96.png" alt="Placeholder image">
                        </figure>
                      </th>
                      <td>
                      <strong>山本　太郎</strong><br>
                      <small>2020/12/15 10:00~</small>
                      </td>
                      <td><i class="far fa-times-circle"></i></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="Faci" class="content-tab" style="display:none">
        <section class="hero is-medium has-text-centered" id="hero-memory">
          <div class="main-index">
            <div class="content">
              <div class="cp_tab">
                <input type="radio" name="cp_tab" id="tab1_1" aria-controls="first_tab01" checked>
                <label for="tab1_1" class="tab-font">全ての写真</label>
                <input type="radio" name="cp_tab" id="tab1_2" aria-controls="second_tab01">
                <label for="tab1_2" class="tab-font">行事ごとの写真</label>
                <div class="cp_tabpanels">
                  <div id="first_tab01" class="cp_tabpanel all-render">
                  <!--全ての写真のタブ-->
                    <% @residents.each do |resident| %>
                      <% @image_columns = [] %>
                      <% resident.memories.each do |m| %>
                        <% @image_columns << m.image0 if m.image0? %>
                        <% @image_columns << m.image1 if m.image1? %>
                        <% @image_columns << m.image2 if m.image2? %>
                        <% @image_columns << m.image3 if m.image3? %>
                        <% @image_columns << m.image4 if m.image4? %>
                        <% @image_columns << m.image5 if m.image5? %>
                        <% @image_columns << m.image6 if m.image6? %>
                        <% @image_columns << m.image7 if m.image7? %>
                      <% end %>
                      <%= render 'memories/all_images', { image_columns: @image_columns, memories: resident.memories, resident: resident } %>
                    <% end %>
                  </div>

                  <!--行事ごとの写真(カード)のタブ-->
                  <div id="second_tab01" class="cp_tabpanel event-render">
                    <% @residents.each do |resident| %>
                      <%= render 'memories/event_card', { memories: resident.memories, resident: resident } %>
                    <% end %>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>

      <div id="Resi" class="content-tab" style="display:none">
        <p>動画を表示</p>
      </div>

      <div id="Infor" class="content-tab" style="display:none">
        <p>お問い合わせ</p>
      </div>
    </article>
  </mypage-main>
</div>

<script>
  function openTab(evt, tabName) {
    var i, x, tablinks;
    x = document.getElementsByClassName("content-tab");
    for (i = 0; i < x.length; i++) {
      x[i].style.display = "none";
    }
    tablinks = document.getElementsByClassName("panel-tab");
    for (i = 0; i < x.length; i++) {
      tablinks[i].className = tablinks[i].className.replace(" is-active", "");
    }
    document.getElementById(tabName).style.display = "block";
    evt.currentTarget.className += " is-active";
  }
</script>
