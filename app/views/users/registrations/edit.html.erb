<section class="hero is-small" id="edit-title">
  <div class="hero-body">
    <div class="container">
      <h1 class="title has-text-centered is-size-5">
        プロフィール編集
      </h1>
    </div>
  </div>
</section>

<section class="edit-image-user">
  <div class="user-home-image">
    <%= @user.user_background %>
    <%= @user.user_background_edit_responsive %>
    <div class="user-icon-outline">
      <%= @user.user_icon_edit_responsive %>
      <div class="user-edit-icon-back">
        <div class="user-edit-icon-image">
          <i class="fas fa-camera"></i>
        </div>
      </div>
      <div class="user-edit-background-back">
        <div class="user-edit-backgroung-image">
          <i class="fas fa-camera"></i>
        </div>
      </div>
    </div>
  </div>
</section>

<div class="main-content">
  <aside>
  </aside>

  <edit-aside>
    <div class="edit-menu-title">
      プロフィール編集
      <div class="profile-section">
        <%= current_user.user_icon_image %>
      </div>
    </div>
    <div class="edit-side-link">
      <div class="panel-tab is-active edit-links" onclick="openTab(event,'Web')"><i class="far fa-user"></i>
        <p>アカウント</p>
      </div>
      <div class="panel-tab edit-links" onclick="openTab(event,'Aud')"><i class="fas fa-key"></i>
        <p>パスワード</p>
      </div>
      <div class="panel-tab edit-links" onclick="openTab(event,'Faci')"><i class="far fa-building"></i>
        <p>登録施設</p>
      </div>
      <div class="panel-tab edit-links" onclick="openTab(event,'Resi')"><i class="fas fa-user-friends"></i>
        <p>登録利用者</p>
      </div>
    </div>
  </edit-aside>

  <main>
    <%= form_for(resource, as: resource_name, url: registration_path(resource_name), html: { method: :put }) do |f| %>
    <%= render "users/shared/error_messages", resource: resource %>
    <article class="panel is-success">
      <div id="Web" class="content-tab">
        <div class="table-layout">
          <table class="table is-fullwidth is-narrow user-edit-table" id="u-edit-table">
            <thead>
              <tr>
                <th><abbr title="Position"></abbr></th>
                <td></td>
              </tr>
            </thead>
            <tfoot>
              <tr>
                <th><abbr title="Position"></abbr></th>
                <td><%= f.submit "更新", class: "button is-success is-fullwidth new-btn has-text-weight-bold edit-tfoot" %>
                </td>
              </tr>
            </tfoot>
            <tbody>
              <tr>
                <th>名前</th>
                <td><%= f.text_field :name, :placeholder => "\uf304 お名前を入力", class: "fa input is-primary" %></td>
              </tr>
              <tr>
                <th>メールアドレス</th>
                <td><%= f.email_field :email, autocomplete: "email", class: "fa input is-primary" %>
                </td>
              </tr>
              <tr>
                <th>電話番号</th>
                <td>
                  <%= f.text_field :phone, class: "fa input is-primary" %>
                </td>
              </tr>
              <tr>
                <th>郵便番号</th>
                <td>
                  <%= f.text_field :postal_code, class: "fa input is-primary" %>
                </td>
              </tr>
              <tr>
                <th>都道府県</th>
                <td>
                  <%= f.text_field :prefecture_name, class: "fa input is-primary" %>
                </td>
              </tr>
              <tr>
                <th>市区町村</th>
                <td>
                  <%= f.text_field :address_city, class: "fa input is-primary" %>
                </td>
              </tr>
              <tr>
                <th>町域・番地</th>
                <td>
                  <%= f.text_field :address_street, class: "fa input is-primary" %>
                </td>
              </tr>
              <tr class="image-change">
                <th>現在のプロフィール画像</th>
                <td>
                  <div>
                    <%= @user.user_icon_edit %>
                  </div>
                </td>
              </tr>
              <tr class="image-change">
                <th>プロフィール画像を変更</th>
                <td>
                  <div class="container">
                    <%= f.file_field :icon, value: "upload", class: "user_img user-icon-field" %>
                    <%= f.hidden_field :icon_cache %>
                  </div>
                </td>
              </tr>
              <% if @user.persisted? && @user.icon? %>
                <tr class="image-change">
                  <th>プロフィール画像を削除</th>
                  <td>
                    <%= f.check_box :remove_icon, id: "user_icon_delete" %>
                    <label for="user_icon_delete" class="check_position has-text-weight-bold" id="img_lavel">
                    </label>&emsp;
                    チェックを入れてください
                  </td>
                </tr>
              <% end %>
              <tr class="image-change">
                <th>現在の背景画像</th>
                <td>
                  <%= @user.user_background_edit %>
                </td>
              </tr>
              <tr class="image-change">
                <th>背景画像を変更</th>
                <td>
                  <%= f.file_field :image, value: "upload", id: "user_bg_img", class: "user-image-field" %>
                  <%= f.hidden_field :image_cache %>
                </td>
              </tr>
              <% if @user.persisted? && @user.image? %>
                <tr class="image-change">
                  <th>背景画像を削除</th>
                  <td>
                    <%= f.check_box :remove_image, id: "bg_delete" %>
                    <label for="bg_delete" class="check_position has-text-weight-bold" id="img_lavel">
                    </label>&emsp;
                    チェックを入れてください
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>

      <div id="Aud" class="content-tab" style="display:none">
        <table class="table is-fullwidth is-narrow user-edit-table" id="u-edit-table">
          <thead>
            <tr>
              <th><abbr title="Position"></abbr></th>
              <td></td>
            </tr>
          </thead>
          <tfoot>
            <tr>
              <th><abbr title="Position"></abbr></th>
              <td>
                <%= f.submit "更新", class: "button is-success is-fullwidth new-btn has-text-weight-bold edit-tfoot" %>
              </td>
            </tr>
          </tfoot>
          <tbody>
            <tr>
              <th>パスワード変更</th>
              <td>
                <%= f.password_field :password, :placeholder => "\uf13e パスワードを入力", autocomplete: "current-password", class: "fa input is-info" %>
                <% if @minimum_password_length %>
                  <br />
                <% end %>
              </td>
            </tr>
            <tr>
              <th>パスワード確認</th>
              <td>
                <%= f.password_field :password_confirmation, :placeholder => "\uf13e パスワードの確認", autocomplete: "current-password", class: "fa input is-info" %>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div id="Faci" class="content-tab" style="display:none">
        <p>登録施設変更画面</p>
      </div>
      <div id="Resi" class="content-tab" style="display:none">
        <p>登録入居者変更画面</p>
      </div>
    </article>
    <% end %>
  </main>
</div>

<script>
  function openTab(evt, tabName) {
    var i, x, tablinks;
    x = document.getElementsByClassName("content-tab");
    for (i = 0; i < x.length; i++) {
      x[i].style.display = "none";
    }
    tablinks = document.getElementsByClassName("panel-tab");
    for (i = 0; i < x.length; i++) {
      tablinks[i].className = tablinks[i].className.replace(" is-active", "");
    }
    document.getElementById(tabName).style.display = "block";
    evt.currentTarget.className += " is-active";
  }
</script>

<script type="text/javascript">
  for (let i = 0; i < 2; i++) {
    $(function() {
      function readURL(input) {
        if (input.files && input.files[0]) {
          var reader = new FileReader();
          reader.onload = function(e) {
            $(`#icon_prev_${i}`).attr('src', e.target.result);
          }
          reader.readAsDataURL(input.files[0]);
        }
      }
      $(".user_img").change(function() {
        readURL(this);
      });
    });
  };
</script>

<script type="text/javascript">
  for (let i = 0; i < 2; i++) {
    $(function() {
      function readURL(input) {
        if (input.files && input.files[0]) {
          var reader = new FileReader();
          reader.onload = function(e) {
            $(`#img_prev_${i}`).attr('src', e.target.result);
          }
          reader.readAsDataURL(input.files[0]);
        }
      }
      $("#user_bg_img").change(function() {
        readURL(this);
      });
    });
  };
</script>
